services:
  example:
    build: .
    restart: on-failure
    networks:
      - traefik
    labels:
      - "traefik.enable=true"
      # openssl s_client -connect localhost:80 -servername static-attachment.category.{{.PublicEntry}} -quiet
      - "traefik.tcp.routers.static_attachment.rule=HostSNI(`static-attachment.category.{{.PublicEntry}}`)"
      - "traefik.tcp.routers.static_attachment.tls=true"
      - "traefik.tcp.services.static_attachment.loadbalancer.server.port=8011"
      - "traefik.tcp.routers.static_attachment.tls.certresolver=letsencrypt"
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: "256M"
        reservations:
          cpus: "0.25"
          memory: "128M"

networks:
  traefik:
    external: true